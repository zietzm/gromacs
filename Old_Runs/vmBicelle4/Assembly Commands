;;;
;;;
;;;

; Start Gromacs
source /usr/local/gromacs/bin/GMXRC

; Generate a box with the determined number of lipids
genbox -ci dppc_single.gro -nmol 628 -box 23.9 8.1 20.4 -try 500 -o dppcs.gro
grompp -f minimization.mdp -c dppcs.gro -p topol.top -maxwarn 10 -o dppc-min.tpr
mdrun -deffnm dppc-min -v

genbox -cp dppc-min.gro -ci dbpc_single.gro -o both.gro -nmol 338 -try 1000
grompp -f minimization.mdp -c both.gro -p topol.top -maxwarn 10 -o lipids_min.tpr
mdrun -deffnm lipids_min -v

; Solvate with water
genbox -cs water.gro -cp lipids_min.gro -o all.gro -maxsol 20000 -vdwd 0.21
grompp -f minimization.mdp -c all.gro -p topol.top -maxwarn 10 -o all_min.tpr
mdrun -deffnm all_min -v

; Minimize the box
grompp -f martini_md.mdp -c all_min.gro -p topol.top -maxwarn 10 -o minim.tpr
mdrun -deffnm minim -v
grompp -f finish_martini_md.mdp -c minim.gro -p topol.top -maxwarn 10 -o 2minim.tpr
mdrun -deffnm 2minim -v

; FIX MOLECULES BROKEN ACROSS PERIODIC BOUNDARY CONDITIONS
trjconv -f minim.xtc -o trajfixed.xtc -s minim.tpr -pbc mol

; Compute densities across the box
g_density -f minim.gro -s minim.tpr -o density.xvg
